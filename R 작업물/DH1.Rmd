---
title: "Untitled"
author: "김동현"
date: '2022 11 21 '
output: html_document
---
---
title: "삶의 만족도와 지역 만족도에 영향있는 지역시설"
author: "김동현"
date: '2022 11 19 '
output: html_document
---

# 1. 데이터 준비
- 종속변수로 '삶의 만족도'와 '지역 만족도'를 설정
- 독립변수로 '병원 수', '상권 수','문화시설 수','학교 수','소득'을 설정
- 서울시의 총 25개 구 데이터를 준비

```{r}
bind <- read.csv("../data/bind.csv", head = TRUE, encoding = "UTF-8")
bind2 <- bind[ ,c(2,8,9,10)]
total <- read.csv("../data/total.csv", head = TRUE, encoding = "UTF-8")
total <- merge(x=total, y = bind2, by = "구")
colnames(total)<- c('구','삶만족도','지역만족도','병원수','상권수','문화시설수','학교수','class1','class2','class3')
  # class1 : 소득200 미만 비율
  # class2 : 소득 200이상 500 미만 비율
  # class3 : 소득 500 이상 비율
str(total)
View(total)
```





# 2. 상관분석

```{r}
# 시각화1
# install.packages('PerformanceAnalytics')
library(PerformanceAnalytics)
chart.Correlation(total[ ,c(2:10) ])

```
```{r}
# 시각화2
# install.packages('corrgram')
library(corrgram)
corrgram(total[ ,c(2:10) ],lower.panel = panel.conf)

```

#### 삶의 만족도와 다른 변수들 간의 상관분석 결과
- 월 200미만 소득가구의 비율과 삶의 만족도는 상관계수 -0.21로 약한 음의 상관관계가 있다고 볼 수 있다.
- 월 500이상 소득가구의 비율과 삶의 만족도는 상관계수 0.15로 아주 약한 양의 상관관계가 있다고 볼 수 있다.
- 병원 수와 삶의 만족도는 상관계수 0.18로 아주 약한 양의 상관관계가 있다고 볼 수 있다.
- 상권 수와 삶의 만족도는 상관계수 0.287로 약한 양의 상관관계가 있다고 볼 수 있다.
- 문화시설 수와 삶의 만족도는 상관계수 0.2로 약한 양의 상관관계가 있다고 볼 수 있다.
- 학교 수와 삶의 만족도는상관계수 -0.1687로 상관관계가 있다고 보기 어렵다.

#### 지역 만족도와 다른 변수들 간의 상관분석 결과
- 월 200미만 소득가구의 비율과 지역 만족도는 상관계수 -0.5 로 음의 상관관계가 있다고 볼 수 있다.
- 월 500이상 소득가구의 비율과 지역 만족도는 상관계수 0.42로 양의 상관관계가 있다고 볼 수 있다.
- 병원수와 지역 만족도는 상관계수 0.4388497로 양의 상관관계가 있다고 볼 수 있다.
- 상권 수와 지역 만족도는 상관계수 0.35로 약한 양의 상관관계가 있다고 볼 수 있다.
- 문화시설 수와 지역 만족도는 상관계수 0.30로 약한 양의 상관관계가 있다고 볼 수 있다.
- 학교 수와 지역 만족도는 상관계수 -0.012로 상관관계가 있다고 보기 어렵다. 

#### 회귀 분석 시, 사용할 변수 결정
- class1, class2, class3은 모두 소득과 관련된 데이터.
- 이 중 class1의 값이 큰 경우, 해당 구 내의 월 소득 200미만 가구 비율이 높은 것
- 이 중 class3의 값이 큰 경우, 해당 구 내의 월 소득 500이상 가구 비율이 높은 것
- class1과 class3 중 소득데이터로 class1 채택
- class3의 경우 500이상이라는 범주가 아주 크기때문에 분석 시 고려해야하므로 class1을 채택.





# 3. 삶의 만족도에 대한 회귀분석 

## 3-1. 종속변수가 삶의 만족도일 때의 Baseline모델

```{r}
lm(삶만족도 ~ class1 + 상권수 + 문화시설수 +병원수 + 학교수  , data=total)
fit <- lm(삶만족도 ~ class1 + 상권수 + 문화시설수 +병원수 +학교수  , data=total)
summary(fit)
```
- Baseline모델의 설명력(Adjusted R-squared)은 0.03382으로 아주 낮다
- 하지만 Baseline모델의 유의확률(p-value)이 0.3608로 유의미한 모델이라고 보기 어렵다
- 이상치의 여부를 확인하여 교정할 것.
- 선형성 여부, 정규분포 여부, 등분산성 여부, 독립성 여부를 확인하여 교정할 것.




## 3-2. 종속변수가 삶의 만족도일 때의 1차 단계적 성능 개선


- 1차 단계적 성능 개선에서의 고려 변수들은 '상권 수', '문화시설 수', '병원 수', '학교 수','소득(class1)' 이다.



## 3-2-1. 이상치의 여부 확인 및 교정

```{r}
# install.packages("car")
library(car)

par(mfrow=c(1,1))
influencePlot(fit, id=list(method = "identify")) 

total1_2 <- total[-c(1,3, 23, 24),]

str(total1_2)
```

- 1, 3, 23, 24 번째 데이터가 이상치임을 확인
- 해당 데이터를 삭제하여 교정

```{r}
fit1_2 <- lm(삶만족도 ~ class1 + 상권수 + 문화시설수 +병원수 + 학교수  , data=total1_2)
summary(fit1_2)


```

- 이상치 제거 후, 설명력(Adjested R-squared) 0.03382 -> 0.1609 로 증가하여 모델의 성능이 향상됨( **+375.75%** ).
- 유의확률(P-value) 또한 0.1803으로 낮아진 것을 볼 수 있지만 아직까지도 유의한 모델이라고 볼 수 없다. 



## 3-2-2. 선형성 여부, 정규분포 여부, 등분산성 여부, 독립성 여부 확인 및 교정

```{r}
par(mfrow=c(2,2))
plot(fit1_2)

```

- Residuals VS Fitted 그래프의 모양이 패턴이 없는 것으로 보아 선형성은 만족해보임
- Normal Q-Q 그래프의 경우 선안에 데이터가 완전히 들어가있다고 보기 어려우므로 정규분포의 여부는 따로 확인이 필요
- Scale-Location 그래프의 모양이 패턴이 없는 것으로 보아 등분산성 만족해보임



#### 정규성 확인 및 교정

```{r}
shapiro.test(resid(fit1_2))
```

- 유의확률(p-value)이 0.8314 의 값을 가지므로 해당 모델은 정규분포를 따른다고 볼 수 있다.



### 3-2-3. 독립성(다중공선성) 여부 확인 및 교정

```{r}
# install.packages("car")
# library(car)
sqrt(vif(fit1_2))

```

- 모든 변수의 VIF가 2보다 작아, 독립성을 만족한다고 볼 수 있다.  



### 3-2-4. 적당한 독립변수 선택

```{r}
library(leaps)
life <- total1_2[ ,-c(1,3,9,10)]
aaa<-regsubsets(`삶만족도`~ . , data = life)
aaa1 <- summary(aaa)

aaa1
aaa1$adjr2

```

```{r}
par(mfrow=c(1,1))
plot(aaa, scale = "adjr2")

```


- 데이터의 갯수가 크지않으므로 모든 가능하 회귀(최량 부분 집합)를 사용하여 적당한 독립변수 탐색
- 탐색 결과, 독립변수가 '문화시설 수', 'class1' 인 경우에서 가장 설명력이 높다.




```{r}
fit1_3 <- lm(삶만족도 ~ 문화시설수 + class1  , data=total1_2)
summary(fit1_3)

```
- 독립변수로 '문화시설 수', 'class1'을 갖는 모델의 설명력은 0.2557
- 설명력 0.1609 -> 0.2557 로 증가하여 모델의 성능이 향상됨( **+58.91%** ).


#### fit1_3 모델의 선형성 여부, 정규분포 여부, 등분산성 여부, 독립성 여부 확인

```{r}
par(mfrow=c(2,2))
plot(fit1_3)

```

- Residuals VS Fitted 그래프의 모양이 패턴이 없는 것으로 보아 선형성은 만족해보임
- Normal Q-Q 그래프의 경우 선에 점들이 모여있는 것으로 보아 정규성 만족해보임
- Scale-Location 그래프의 모양이 패턴이 없는 것으로 보아 등분산성 만족해보임





#### fit1_3 모델의 이상치의 여부 확인 및 교정

```{r}
# install.packages("car")
# library(car)

par(mfrow=c(1,1))
influencePlot(fit1_3, id=list(method = "identify")) 

total1_4 <- total[-c(1,3,21,23,24),]

str(total1_4)
```

```{r}
fit1_4 <- lm(삶만족도 ~ 문화시설수 + class1  , data=total1_4)
summary(fit1_4)

```

- 독립변수로 '문화시설 수', 'class1'을 갖는 모델(fit1_3)의 이상치를 제거 한 후의 설명력은 0.3409
- 설명력 0.2557 -> 0.3409 로 증가하여 모델의 성능이 향상됨( **+33.32%** ).








## 3-3. 종속변수가 삶의 만족도일 때의 2차 단계적 성능 개선


- 2차 단계적 성능 개선에서의 추가된 고려 변수들은 '버스정거장 수', '지하철역 수', '총 인구 수', '파출소 수', '아파트 수'이다.
  





































================================================================================







# 4. 지역 만족도에 대한 회귀분석 

## 4-1. 종속변수가 지역 만족도일 때의 Baseline모델

```{r}
fit2_1 <- lm(지역만족도 ~ class1 + 상권수 + 문화시설수 +병원수 +학교수  , data=total)
summary(fit2_1)
```
- Baseline모델의 설명력(Adjusted R-squared)은 0.3406 이다. 
- Baseline모델의 유의확률(p-value)이 0.02117로 유의미한 모델이다.
- 이상치의 여부를 확인하여 교정할 것.
- 선형성 여부, 정규분포 여부, 등분산성 여부, 독립성 여부를 확인하여 교정할 것.




## 4-2. 종속변수가 지역 만족도일 때의 1차 단계적 성능 개선


- 1차 단계적 성능 개선에서의 고려 변수들은 '상권 수', '문화시설 수', '병원 수', '학교 수','소득(class1)' 이다.



## 4-2-1. 이상치의 여부 확인 및 교정

```{r}
# install.packages("car")
# library(car)

par(mfrow=c(1,1))
influencePlot(fit2_1, id=list(method = "identify")) 

total2_2 <- total[-c(1,3, 23, 24),]

str(total2_2)
```

- 1, 3, 23, 24 번째 데이터가 이상치임을 확인
- 해당 데이터를 삭제하여 교정

```{r}
fit2_2 <- lm(지역만족도 ~ class1 + 상권수 + 문화시설수 +병원수 + 학교수  , data=total2_2)
summary(fit2_2)


```

- 이상치 제거 후, 설명력(Adjested R-squared) 0.3406 -> 0.4792 로 증가하여 모델의 성능이 향상됨( **+40.69%** ).
- 유의확률(P-value) 또한 0.0089로 더 낮아진 유의미한 모델이다.




## 4-2-2. 선형성 여부, 정규분포 여부, 등분산성 여부, 독립성 여부 확인 및 교정

```{r}
par(mfrow=c(2,2))
plot(fit2_2)

```

- Residuals VS Fitted 그래프의 모양이 패턴이 없는 것으로 보아 선형성은 만족해보임
- Normal Q-Q 그래프의 경우 선안에 데이터가 완전히 들어가있다고 보기 어려우므로 정규분포의 여부는 따로 확인이 필요
- Scale-Location 그래프의 모양이 패턴이 없는 것으로 보아 등분산성 만족해보임



#### 정규성 확인 및 교정

```{r}
shapiro.test(resid(fit2_2))
```

- 유의확률(p-value)이 0.3358 의 값을 가지므로 해당 모델은 정규분포를 따른다고 볼 수 있다.



### 4-2-3. 독립성(다중공선성) 여부 확인 및 교정

```{r}
# install.packages("car")
# library(car)
sqrt(vif(fit2_2))

```

- 모든 변수의 VIF가 2보다 작아, 독립성을 만족한다고 볼 수 있다.  



### 4-2-4. 적당한 독립변수 선택

```{r}
# library(leaps)
region <- total2_2[ ,-c(1,2,9,10)]
bbb<-regsubsets(`지역만족도`~ . , data = region)
bbb1 <- summary(bbb)

bbb1
bbb1$adjr2

```

```{r}
par(mfrow=c(1,1))
plot(bbb, scale = "adjr2")

```


- 데이터의 갯수가 크지않으므로 모든 가능하 회귀(최량 부분 집합)를 사용하여 적당한 독립변수 탐색
- 탐색 결과, 독립변수가 '병원 수', 'class1' 인 경우에서 가장 설명력이 높다.
- 탐색 결과, 독립변수가 '병원 수', '학교 수', 'class1' 인 경우가 두번째로 설명력이 높다.




```{r}
fit2_3 <- lm(지역만족도 ~ 병원수 + class1  , data=total2_2)
summary(fit2_3)

```
- 독립변수로 '병원 수', 'class1'을 갖는 모델의 설명력은 0.5381
- 설명력 0.4792 -> 0.5381 로 증가하여 모델의 성능이 향상됨( **+12.29%** ).
- 유의확률(p-value)이 0.0003으로 유의미한 모델이라고 볼 수 있다.



```{r}
fit2_3_2 <- lm(지역만족도 ~ 병원수 +학교수+ class1  , data=total2_2)
summary(fit2_3_2)

```

- 독립변수로 '병원 수', '학교 수', 'class1'을 갖는 모델의 설명력은 0.5351
- 설명력 0.4792 -> 0.5351 로 증가하여 모델의 성능이 향상됨( **+11.66%** ).
- 유의확률(p-value)이 0.001으로 유의미한 모델이라고 볼 수 있다.


#### fit2_3 모델의 선형성 여부, 정규분포 여부, 등분산성 여부, 독립성 여부 확인

```{r}
par(mfrow=c(2,2))
plot(fit2_3)

```


- Residuals VS Fitted 그래프의 모양이 패턴이 없는 것으로 보아 선형성은 만족해보임
- Normal Q-Q 그래프의 경우 선에 점들이 모여있는 것으로 보아 정규성 만족해보임
- Scale-Location 그래프의 모양이 패턴이 없는 것으로 보아 등분산성 만족해보임




#### fit1_3 모델의 이상치의 여부 확인 및 교정

```{r}
# install.packages("car")
# library(car)

par(mfrow=c(1,1))
influencePlot(fit1_3, id=list(method = "identify")) 

total1_4 <- total[-c(1,3,21,23,24),]

str(total1_4)
```

```{r}
fit1_4 <- lm(삶만족도 ~ 문화시설수 + class1  , data=total1_4)
summary(fit1_4)

```

- 독립변수로 '문화시설 수', 'class1'을 갖는 모델(fit1_3)의 이상치를 제거 한 후의 설명력은 0.3409
- 설명력 0.2557 -> 0.3409 로 증가하여 모델의 성능이 향상됨( **+33.32%** ).
















## 4-3. 종속변수가 지역 만족도일 때의 2차 단계적 성능 개선


- 2차 단계적 성능 개선에서의 추가된 고려 변수들은 '버스정거장 수', '지하철역 수', '총 인구 수', '파출소 수', '아파트 수'이다.

























